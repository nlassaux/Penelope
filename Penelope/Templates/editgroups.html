{% extends "base_log.html" %}
{% load url from future %}
{% block title %}Create groups | {{editedassignment.name}}{% endblock %}

{% block breadcrumb %}

	<ul class="breadcrumb">
		<div class='swift'>
			<li>>> <a href="/">Dashboard</a><span class="divider">/</span></li>
			<li><a href="/{{editedassignment.course.id}}/details/">{{editedassignment.course.name}}</a><span class="divider">/</span></li>
			<li><a href="/assignments/{{editedassignment.id}}/details/">{{editedassignment.name}}</a><span class="divider">/</span></li>
			<li class="active">Edit groups</li>
	  </div>
  </ul>

{% endblock %}



{% block content %}

	<div class='row'>
		<div class='span5 panel'>
			<h4>Users</h4>
			<hr>
			<p></p>
			<div id='users'>
				{% for user in editedassignment.course.subscribed.all %}
					<div draggable="true" class='user-balise' id='{{user}}'>{{user}}</div>
				{% endfor %}
			</div>
			<hr>
		<a onClick='newgroup()' class="btn btn-">New group</a>
		</div>
		<div class='span6 panel' id='groups'>
			<h4>Groups</h4>
			<hr>
	  	<div class="panel_drop" name='group'  id="group1">
	  			<h5>Group 1</h5>
	  			<div class='drop_zone'></div>
	  	</div>
	  </div>
	</div>



{% endblock %}



{% block scripts%}

	<script>

	  /* on associe le dÃ©marrage du drag and drop a la fonction
	     dragStartHandler */
	  document.addEventListener("dragstart", dragStartHandler, false);

	  function dragStartHandler(event) {
	      /* autoriser les drag and drop de type "copy" */
	      event.dataTransfer.effectAllowed = 'move';
	      /* transmettre en donnÃ©e de drag and drop l'id de la boite
	         dÃ©placÃ©e */
	      event.dataTransfer.setData('Text', event.target.id);
	      return false;
	  }


	  /* on associe l'entrÃ©e du drag and drop sur la cible a la fonction
	     dragEnterHandler */
	  document.addEventListener("dragenter", dragEnterHandler, false);

	  function dragEnterHandler(event) {
	      /* eviter le comportement par dÃ©faut du navigateur (deplacement
	         de selection) */
	      event.preventDefault();
	      return false;
	  }

	  /* on associe le survole de la cible a  la fonction
	     dragOverHandler */
	  var e = document.getElementsByName('group');
	  for(var i=1;i<=e.length;i++){
	  	document.getElementById('group'+[i]).addEventListener("dragover", dragOverHandler, false);
	  }
	  document.getElementById('users').addEventListener("dragover", dragOverHandler, false);

	  function dragOverHandler(event) {
      /* verification de la cible au cas ou l'on survole un autre objet */
      if ((event.target.name == 'group') && (event.target != document.getElementById('users'))) {
          return false;
          alert('erreeuuuur')
      } else {
          /* on attribue l'effet de curseur qui correspond au type
             accepte plus haut */
          event.dataTransfer.dropEffect = 'move';
          /* Ã©viter le comportement par dÃ©faut du navigateur
             (dÃ©placement de sÃ©lection) */
          event.preventDefault();
      }
      return false;
	  }


	  /* on associe le 'lachÃ©' d'un Ã©lÃ©ment sur la cible Ã  la fonction
	     dropHandler */
	  var e = document.getElementsByName('group');

	  for(var i=1;i<=e.length;i++){
	  	document.getElementById('group'+[i]).addEventListener("drop", dropHandler, false);
	  }
	  document.getElementById('users').addEventListener("drop", dropHandler, false);

	  function dropHandler(event) {
	  	event.preventDefault();
      /* on se sert de l'id transportÃ© en donnÃ©e pour dÃ©placer
         l'Ã©lÃ©ment dans son nouveau parent DOM */
      event.target.appendChild(document.getElementById(event.dataTransfer.getData('Text')));
      /* on coupe manuellement la propagation de l'Ã©vÃ¨nement (pas forcÃ©ment nÃ©cessaire !) */
      event.stopPropagation();
      return false;
	  }


	  function newgroup() {
			var e = document.getElementsByName('group');
			var nb = e.length + 1;
			div = document.createElement("div");
			div.id = 'group'+nb;
			div.className = 'panel_drop';
			div.setAttribute('name', 'group');
			div.innerHTML = '<h5>Group '+nb+'</h5>';
			div.innerHTML += '<div class=\'drop_zone\'></div>';
			document.getElementById('groups').appendChild(div);



			div.addEventListener("drop", dropHandler, false);
			div.addEventListener("dragover", dragOverHandler, false);
		}

	</script>

{% endblock %}